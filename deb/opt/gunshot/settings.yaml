
type: section
title: Gunshot Detector Proxy Configuration
settings:
  network:
    type: section
    title: Networking
    on_edit: sudo systemctl restart gunshot_network_config.service
    settings:
      autoconf:
        type: select
        label: Autoconfiguration
        options:
          none: Use Static IP
          any: Use any available method (DHCP + BOOTP + RARP)
          dhcp: Use DHCP only.
          bootp: Use BOOTP only.
          rarp: Use RARP only.
        default: any
      hostname:
        type: text
        label: Hostname
      client_ip:
        type: text
        label: IP Address
        hint: (Static IP or Fallback)
      netmask:
        type: text
        label: Subnet Mask
      gw_ip:
        type: text
        label: Default Gateway
      dns0_ip:
        type: text
        label: Primary DNS
      dns1_ip:
        type: text
        label: Secondary DNS
      ntp0_ip:
        type: text
        label: NTP Server
  mqtt:
    type: section
    title: MQTT Broker Settings
    on_edit:
      - sudo systemctl restart gunshot@event.service
      - sudo systemctl restart gunshot@senseit_server.service
      - sudo systemctl restart gunshot@senseit_client.service
      - sudo systemctl restart gunshot@detector.service
      - sudo systemctl restart gunshot@onvif_ptz.service
      - sudo systemctl restart gunshot@onvif_relay.service
      - sudo systemctl restart gunshot@rcp_ptz.service
      - sudo systemctl restart gunshot@versatile.service
    settings:
      server:
        type: section
        title: Server
        settings:
          host:
            type: text
            label: Host
            default: 127.0.0.1
            hint: IP or Hostname
          port:
            type: number
            label: Port
            default: 1883
            hint: (usually 1883)
      topics:
        type: section
        title: Topics
        settings:
          evt_all:
            type: text
            label: All Events (JSON)
            default: sentri/detector/event/all
          evt_alarm:
            type: text
            label: Filtered Events (JSON)
            default: sentri/detector/event/alarm
          evt_raw:
            type: text
            label: Raw Event Data
            default: sentri/detector/event/raw
          cmd_raw:
            type: text
            label: Raw Commands
            default: sentri/detector/command/raw
  events:
    type: section
    title: Event Filtering
    on_edit: sudo systemctl restart gunshot@event.service
    settings:
      gunshot:
        type: checkbox
        label: gunshot
        default: true
      non-gunshot:
        type: checkbox
        label: non-gunshot
        default: true
  senseit_server:
    type: section
    title: SenseIT Server
    on_edit: sudo systemctl restart gunshot@senseit_server.service
    settings:
      enable:
        type: checkbox
        label: Enable
      bind:
        type: text
        label: Bind
        hint: Local IP + Port (blank for auto)
        default: :10001
      conn:
        type: text
        label: Connect
        hint: Remote IP + Port
        default: :10002
  senseit_client:
    type: section
    title: SenseIT Client
    on_edit: sudo systemctl restart gunshot@senseit_client.service
    settings:
      enable:
        type: checkbox
        label: Enable
      bind:
        type: text
        label: Listen
        hint: Local IP + Port
        default: :10004
  detector:
    type: section
    title: SenseIT Sentry Detector
    on_edit: sudo systemctl restart gunshot@detector.service
    settings:
      enable:
        type: checkbox
        label: Enable
      bind:
        type: text
        label: Listen
        hint: Local IP + Port
        default: :10002
  onvif:
    type: section
    title: ONVIF Camera Control
    settings:
      conn:
        type: text
        label: ONVIF URL
        hint: http://username@password:mycamera.mydomain/
        on_edit:
          - sudo systemctl restart gunshot@onvif_ptz.service
          - sudo systemctl restart gunshot@onvif_relay.service
      ptz:
        type: section
        title: PTZ
        on_edit: sudo systemctl restart gunshot@onvif_ptz.service
        settings:
          enable:
            type: checkbox
            label: Enable
          az_min:
            type: number
            label: Azimuth Min
            default: -180
          az_max:
            type: number
            label: Azimuth Max
            default: 180
          az_off:
            type: number
            label: Azimuth Offset
            default: 0
          el_min:
            type: number
            label: Elevation Min
            default: 0
          el_max:
            type: number
            label: Elevation Max
            default: 90
          el_off:
            type: number
            label: Elevation Offset
            default: 0
          z_min:
            type: number
            label: Zoom Min
            default: 0
          z_max:
            type: number
            label: Zoom Max
            default: 1
          z_off:
            type: number
            label: Zoom Offset
            default: 0
      relay:
        type: section
        title: Relay Alarm
        on_edit: sudo systemctl restart gunshot@onvif_relay.service
        settings:
          enable:
            type: checkbox
            label: Enable
          type:
            type: select
            label: Identifier Type
            options:
              number: Relay Number (specify ID as a number)
              token: Relay Token (specify ID as a string)
            default: token
          id:
            type: text
            label: Relay Identifier
          mode:
            type: select
            label: Mode
            options:
              Monostable: Monostable
              Bistable: Bistable
            default: Monostable
          time:
            type: number
            label: Activation Time
            hint: seconds
            default: 2
          idle:
            type: select
            label: Idle State
            options:
              open: Open
              closed: Closed
            default: open
  rcp_ptz:
    type: section
    title: RCP PTZ
    on_edit: sudo systemctl restart gunshot@rcp_ptz.service
    settings:
      enable:
        type: checkbox
        label: Enable
      url:
        type: text
        label: URL
        hint: e.g. http://username@password:mycamera.mydomain/rcp.xml
      limits:
        type: section
        title: Limits
        settings:
          az_off:
            type: number
            label: Azimuth Offset
            default: 0
          az_flip:
            type: checkbox
            label: Azimuth Flip
            default: false
          el_off:
            type: number
            label: Elevation Offset
            default: 0
          z_off:
            type: number
            label: Zoom Offset
            default: 0
  versatile:
    type: section
    title: Versatile Packet Output
    on_edit: sudo systemctl restart gunshot@versatile.service
    settings:
      enable:
        type: checkbox
        label: Enable
      bind:
        type: text
        label: Bind
        hint: Local IP + Port (blank for auto)
      conn:
        type: text
        label: Connect
        hint: Remote IP + Port or URL (blank for auto)
        descr: >
          Recognises protocol schemes <code>http://</code>, <code>https://</code>, <code>tcp://</code> and <code>udp://</code>.
      template:
        type: blocktext
        label: Template
        descr: >
          Template supports full python format string syntax.
          Available Substitutions:<br/>
            <code>{evt.time}</code>: Event timestamp, in ISO-8601 format (e.g. <code>2021-02-16T13:50:03.815166</code>).<br/>
            <code>{evt.raw}</code>: Base64 encoded raw SenseIT packet data.<br/>
            <code>{evt.alarm_num}</code>: Alarm number, increments on each event (rolls over from 255 to 0).<br/>
            <code>{evt.az_raw}</code>: Detector-relative azimuth angle of the event.<br/>
            <code>{evt.el_raw}</code>: Detector-relative elevation angle of the event.<br/>
            <code>{evt.time_detector}</code>: Detector RTC time (generally not accurate).<br/>
            <code>{evt.event_type}</code>: The string "gunshot" or "non-gunshot" depending on event classification.<br/>
            <code>{evt.device_type}</code>: The string "detector" or "server" depending on packet origin.<br/>
          To output braces in the sent packet, use double braces (i.e.<code>{{</code> in the template will result in <code>{</code> in the output).
          All other characters (including newlines) are literal.
        default: >
          {{
            "time": {time},
            "raw": {raw},
            "alarm_num": {alarm_num},
            "el_raw": {el_raw},
            "az_raw": {az_raw},
            "time_detector": {time_detector},
            "event_type": {event_type},
            "device_type": {device_type},
            "mic_data":{{
              "mic0_w": {mic0_w},
              "mic0_s": {mic0_s},
              "mic0_d": {mic0_d},
              "mic1_w": {mic1_w},
              "mic1_s": {mic1_s},
              "mic1_d": {mic1_d},
              "mic2_w": {mic2_w},
              "mic2_s": {mic2_s},
              "mic2_d": {mic2_d},
              "mic3_w": {mic3_w},
              "mic3_s": {mic3_s},
              "mic3_d": {mic3_d},
            }}
          }}



